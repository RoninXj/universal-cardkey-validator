# é’é¾™é¢æ¿ä½¿ç”¨é€šç”¨å¡å¯†æ¨¡å—æŒ‡å—

> **æœ¬æŒ‡å—é€‚ç”¨äºåœ¨é’é¾™é¢æ¿ä¸­ä½¿ç”¨é€šç”¨å¡å¯†éªŒè¯æ¨¡å—**

## ğŸ“š æ–‡æ¡£å¯¼èˆª

- **[å¿«é€Ÿå¼€å§‹](QUICK_START.md)** - 5åˆ†é’Ÿå¿«é€Ÿé›†æˆ
- **[å®Œæ•´æ–‡æ¡£](README-UNIVERSAL.md)** - å®Œæ•´ API æ–‡æ¡£
- **[æ¨¡å—æŒ‡å—](CARDKEY_MODULE_GUIDE.md)** - æ¨¡å—åŒ–ä½¿ç”¨æŒ‡å—
- **[å®‰è£…æŒ‡å—](INSTALL_GUIDE.md)** - å®‰è£…å’Œéƒ¨ç½²æŒ‡å—
- **[é’é¾™é¢æ¿](QINGLONG_GUIDE.md)** - ä½ æ­£åœ¨é˜…è¯» â­
- **[æ–‡æ¡£ç´¢å¼•](DOCUMENTATION_INDEX.md)** - æ‰€æœ‰æ–‡æ¡£å¯¼èˆª

## ğŸ“– æ¦‚è¿°

æœ¬æ¨¡å—æ˜¯ä¸€ä¸ªé€šç”¨çš„å¡å¯†éªŒè¯è§£å†³æ–¹æ¡ˆï¼Œå¯ä»¥ç”¨äºä»»ä½•è„šæœ¬é¡¹ç›®ï¼š
- å¿«æ‰‹è„šæœ¬
- æŠ–éŸ³è„šæœ¬
- çˆ¬è™«è„šæœ¬
- è‡ªåŠ¨åŒ–è„šæœ¬
- å…¶ä»–ä»»ä½•éœ€è¦å¡å¯†éªŒè¯çš„è„šæœ¬

## ğŸ¯ æ–¹æ¡ˆå¯¹æ¯”

### æ–¹æ¡ˆ1ï¼šä½¿ç”¨é’é¾™é¢æ¿ä¾èµ–ç®¡ç†ï¼ˆæ¨èï¼‰â­

**ä¼˜ç‚¹ï¼š**
- âœ… æ ‡å‡†çš„ npm ä¾èµ–ç®¡ç†æ–¹å¼
- âœ… ç»Ÿä¸€ç®¡ç†ï¼Œä¾¿äºæ›´æ–°å’Œç»´æŠ¤
- âœ… æ‰€æœ‰è„šæœ¬å…±äº«åŒä¸€æ¨¡å—ï¼ŒèŠ‚çœç©ºé—´
- âœ… ç‰ˆæœ¬æ§åˆ¶æ¸…æ™°ï¼Œæ”¯æŒç‰ˆæœ¬å›æ»š
- âœ… ç¬¦åˆ Node.js æœ€ä½³å®è·µ

**ç¼ºç‚¹ï¼š**
- âŒ éœ€è¦åœ¨é’é¾™é¢æ¿é…ç½®ä¾èµ–
- âŒ é¦–æ¬¡å®‰è£…éœ€è¦ä¸€å®šæ—¶é—´
- âŒ éœ€è¦ GitHub è®¿é—®æƒé™

**é€‚ç”¨åœºæ™¯ï¼š** 
- å¤šä¸ªè„šæœ¬ä½¿ç”¨åŒä¸€æ¨¡å—
- é•¿æœŸç»´æŠ¤çš„é¡¹ç›®
- éœ€è¦ç‰ˆæœ¬ç®¡ç†çš„åœºæ™¯

### æ–¹æ¡ˆ2ï¼šåŠ¨æ€åŠ è½½ GitHub åŸå§‹æ–‡ä»¶

**ä¼˜ç‚¹ï¼š**
- âœ… æ— éœ€é¢„å…ˆå®‰è£…ä¾èµ–
- âœ… æ”¯æŒè‡ªåŠ¨æ›´æ–°ï¼ˆå¯é…ç½®ç¼“å­˜ï¼‰
- âœ… è„šæœ¬ç›¸å¯¹ç‹¬ç«‹
- âœ… é€‚åˆå¿«é€Ÿæµ‹è¯•

**ç¼ºç‚¹ï¼š**
- âŒ é¦–æ¬¡åŠ è½½éœ€è¦ç½‘ç»œè¿æ¥
- âŒ GitHub è®¿é—®å¯èƒ½è¾ƒæ…¢æˆ–ä¸ç¨³å®š
- âŒ éœ€è¦é¢å¤–çš„åŠ è½½å™¨ä»£ç 
- âŒ æ¯ä¸ªè„šæœ¬éƒ½è¦åŒ…å«åŠ è½½é€»è¾‘

**é€‚ç”¨åœºæ™¯ï¼š** 
- ä¸´æ—¶æµ‹è¯•å’Œå¼€å‘
- å•ä¸ªè„šæœ¬é¡¹ç›®
- éœ€è¦å¿«é€Ÿéƒ¨ç½²çš„åœºæ™¯

### æ–¹æ¡ˆ3ï¼šå†…åµŒæ¨¡å—ä»£ç 

**ä¼˜ç‚¹ï¼š**
- âœ… æ— éœ€ç½‘ç»œè¯·æ±‚ï¼Œå®Œå…¨ç¦»çº¿è¿è¡Œ
- âœ… å®Œå…¨ç‹¬ç«‹ï¼Œä¸ä¾èµ–å¤–éƒ¨èµ„æº
- âœ… åŠ è½½é€Ÿåº¦æœ€å¿«
- âœ… é€‚åˆç½‘ç»œå—é™ç¯å¢ƒ

**ç¼ºç‚¹ï¼š**
- âŒ æ¯ä¸ªè„šæœ¬éƒ½è¦å¤åˆ¶å®Œæ•´ä»£ç 
- âŒ æ›´æ–°æ¨¡å—éœ€è¦ä¿®æ”¹æ‰€æœ‰è„šæœ¬
- âŒ ä»£ç å†—ä½™ï¼Œç»´æŠ¤æˆæœ¬é«˜
- âŒ è„šæœ¬æ–‡ä»¶ä½“ç§¯å¤§

**é€‚ç”¨åœºæ™¯ï¼š** 
- ç½‘ç»œä¸ç¨³å®šæˆ–æ— ç½‘ç»œç¯å¢ƒ
- å•ä¸ªç‹¬ç«‹è„šæœ¬
- å¯¹ç¨³å®šæ€§è¦æ±‚æé«˜çš„åœºæ™¯

## ğŸ“ æ–¹æ¡ˆ1ï¼šä½¿ç”¨ä¾èµ–ç®¡ç†ï¼ˆæ¨èï¼‰â­

### æ­¥éª¤1ï¼šå‘å¸ƒæ¨¡å—åˆ° GitHub

#### 1.1 å‡†å¤‡æ¨¡å—æ–‡ä»¶

ç¡®ä¿ä½ çš„é¡¹ç›®åŒ…å«ä»¥ä¸‹æ–‡ä»¶ï¼š
- `cardkey-validator.js` - æ ¸å¿ƒæ¨¡å—ä»£ç 
- `package.json` - æ¨¡å—é…ç½®æ–‡ä»¶
- `README-UNIVERSAL.md` - æ¨¡å—è¯´æ˜æ–‡æ¡£
- `.gitignore` - Git å¿½ç•¥æ–‡ä»¶é…ç½®

#### 1.2 ä¸Šä¼ åˆ° GitHub

åœ¨æœ¬åœ°é¡¹ç›®ç›®å½•æ‰§è¡Œï¼š

```bash
# åˆå§‹åŒ– Git ä»“åº“
git init

# æ·»åŠ æ–‡ä»¶
git add cardkey-validator.js package.json README-UNIVERSAL.md .gitignore

# æäº¤
git commit -m "é€šç”¨å¡å¯†éªŒè¯æ¨¡å— v1.0.0"

# æ·»åŠ è¿œç¨‹ä»“åº“ï¼ˆæ›¿æ¢ your-username ä¸ºä½ çš„ GitHub ç”¨æˆ·åï¼‰
git remote add origin https://github.com/your-username/universal-cardkey-validator.git

# æ¨é€åˆ° GitHub
git branch -M main
git push -u origin main

# åˆ›å»ºç‰ˆæœ¬æ ‡ç­¾
git tag -a v1.0.0 -m "Release version 1.0.0"
git push origin v1.0.0
```

### æ­¥éª¤2ï¼šåœ¨é’é¾™é¢æ¿ä¸­å®‰è£…ä¾èµ–

#### æ–¹æ³•Aï¼šé€šè¿‡ Web ç•Œé¢å®‰è£…ï¼ˆæ¨èï¼‰

1. ç™»å½•é’é¾™é¢æ¿
2. è¿›å…¥ **ä¾èµ–ç®¡ç†**
3. é€‰æ‹© **NodeJs** æ ‡ç­¾
4. ç‚¹å‡» **æ–°å»ºä¾èµ–**
5. è¾“å…¥ä¾èµ–åç§°ï¼š
   ```
   github:your-username/universal-cardkey-validator#v1.0.0
   ```
6. ç‚¹å‡» **ç¡®å®š**
7. ç­‰å¾…å®‰è£…å®Œæˆ

#### æ–¹æ³•Bï¼šé€šè¿‡å‘½ä»¤è¡Œå®‰è£…

```bash
# è¿›å…¥é’é¾™å®¹å™¨
docker exec -it qinglong bash

# è¿›å…¥è„šæœ¬ç›®å½•
cd /ql/scripts

# å®‰è£…ä¾èµ–
npm install github:your-username/universal-cardkey-validator#v1.0.0
```

### æ­¥éª¤3ï¼šåœ¨è„šæœ¬ä¸­ä½¿ç”¨æ¨¡å—

åœ¨ä½ çš„è„šæœ¬æ–‡ä»¶å¼€å¤´æ·»åŠ ï¼š

```javascript
const { initializeCardKeyValidator, getCardKeyValidator } = require('universal-cardkey-validator');

// åˆå§‹åŒ–å¡å¯†éªŒè¯å™¨
initializeCardKeyValidator();

// åœ¨éœ€è¦éªŒè¯çš„åœ°æ–¹ä½¿ç”¨
async function yourFunction() {
    const validator = getCardKeyValidator();
    const result = await validator.verify();
    
    if (!result.success) {
        console.log('å¡å¯†éªŒè¯å¤±è´¥:', result.message);
        return;
    }
    
    // ç»§ç»­æ‰§è¡Œä½ çš„é€»è¾‘...
}
```

### æ­¥éª¤4ï¼šé…ç½®ç¯å¢ƒå˜é‡

åœ¨é’é¾™é¢æ¿çš„ **ç¯å¢ƒå˜é‡** ä¸­æ·»åŠ ï¼š

```bash
# å¿…éœ€ï¼šå¡å¯†
CARD_KEY=your_card_key_here

# å¯é€‰ï¼šéªŒè¯æ¥å£åœ°å€
VERIFY_URL=https://your-api.com/verify

# å¯é€‰ï¼šç¼“å­˜è¶…æ—¶æ—¶é—´ï¼ˆç§’ï¼‰
VERIFY_CACHE_TIMEOUT=3600
```

### æ­¥éª¤5ï¼šåˆ›å»ºå®šæ—¶ä»»åŠ¡

åœ¨é’é¾™é¢æ¿çš„ **å®šæ—¶ä»»åŠ¡** ä¸­åˆ›å»ºä»»åŠ¡ï¼š
- **åç§°**ï¼šä½ çš„è„šæœ¬åç§°
- **å‘½ä»¤**ï¼š`task your-script.js`
- **å®šæ—¶è§„åˆ™**ï¼šæ ¹æ®éœ€æ±‚è®¾ç½®ï¼ˆå¦‚ï¼š`0 */2 * * *`ï¼‰

---

## ğŸ“ æ–¹æ¡ˆ2ï¼šåŠ¨æ€åŠ è½½ GitHub æ–‡ä»¶

å¦‚æœä¸æƒ³ä½¿ç”¨ä¾èµ–ç®¡ç†ï¼Œå¯ä»¥åŠ¨æ€åŠ è½½æ¨¡å—ã€‚

### åˆ›å»ºåŠ è½½å™¨

åˆ›å»ºä¸€ä¸ªåŠ è½½å™¨æ–‡ä»¶ `cardkey-loader.js`ï¼ˆå¯é€‰ï¼‰ï¼š

```javascript
/**
 * å¡å¯†æ¨¡å—åŠ è½½å™¨ - é€‚ç”¨äºé’é¾™é¢æ¿
 * æ”¯æŒä» GitHub åŠ¨æ€åŠ è½½æˆ–ä½¿ç”¨æœ¬åœ°ç¼“å­˜
 */

const https = require('https');
const http = require('http');
const fs = require('fs');
const path = require('path');

// é…ç½®
const GITHUB_RAW_URL = 'https://raw.githubusercontent.com/your-username/kuaishou-cardkey-validator/main/cardkey-validator.js';
const CACHE_DIR = path.join(__dirname, '.cardkey-cache');
const CACHE_FILE = path.join(CACHE_DIR, 'cardkey-validator.js');
const CACHE_DURATION = 24 * 60 * 60 * 1000; // 24å°æ—¶

/**
 * ä¸‹è½½æ–‡ä»¶
 */
function downloadFile(url) {
    return new Promise((resolve, reject) => {
        const client = url.startsWith('https') ? https : http;
        
        client.get(url, (res) => {
            if (res.statusCode === 302 || res.statusCode === 301) {
                // å¤„ç†é‡å®šå‘
                return downloadFile(res.headers.location).then(resolve).catch(reject);
            }
            
            if (res.statusCode !== 200) {
                reject(new Error(`ä¸‹è½½å¤±è´¥ï¼ŒçŠ¶æ€ç : ${res.statusCode}`));
                return;
            }

            let data = '';
            res.on('data', chunk => data += chunk);
            res.on('end', () => resolve(data));
        }).on('error', reject);
    });
}

/**
 * æ£€æŸ¥ç¼“å­˜æ˜¯å¦æœ‰æ•ˆ
 */
function isCacheValid() {
    try {
        if (!fs.existsSync(CACHE_FILE)) {
            return false;
        }
        
        const stats = fs.statSync(CACHE_FILE);
        const age = Date.now() - stats.mtimeMs;
        return age < CACHE_DURATION;
    } catch (error) {
        return false;
    }
}

/**
 * ä¿å­˜ç¼“å­˜
 */
function saveCache(content) {
    try {
        if (!fs.existsSync(CACHE_DIR)) {
            fs.mkdirSync(CACHE_DIR, { recursive: true });
        }
        fs.writeFileSync(CACHE_FILE, content, 'utf8');
    } catch (error) {
        console.log('âš ï¸ ä¿å­˜ç¼“å­˜å¤±è´¥:', error.message);
    }
}

/**
 * è¯»å–ç¼“å­˜
 */
function readCache() {
    try {
        return fs.readFileSync(CACHE_FILE, 'utf8');
    } catch (error) {
        return null;
    }
}

/**
 * åŠ è½½å¡å¯†æ¨¡å—
 */
async function loadCardKeyModule() {
    console.log('ğŸ”„ åŠ è½½å¡å¯†éªŒè¯æ¨¡å—...');
    
    // 1. æ£€æŸ¥ç¼“å­˜
    if (isCacheValid()) {
        console.log('âœ… ä½¿ç”¨ç¼“å­˜çš„å¡å¯†æ¨¡å—');
        const cachedCode = readCache();
        if (cachedCode) {
            try {
                const module = { exports: {} };
                eval(cachedCode);
                return module.exports;
            } catch (error) {
                console.log('âš ï¸ ç¼“å­˜æ¨¡å—åŠ è½½å¤±è´¥ï¼Œå°è¯•é‡æ–°ä¸‹è½½');
            }
        }
    }
    
    // 2. ä» GitHub ä¸‹è½½
    try {
        console.log('ğŸ“¥ ä» GitHub ä¸‹è½½å¡å¯†æ¨¡å—...');
        const code = await downloadFile(GITHUB_RAW_URL);
        
        // ä¿å­˜ç¼“å­˜
        saveCache(code);
        
        // æ‰§è¡Œä»£ç 
        const module = { exports: {} };
        eval(code);
        
        console.log('âœ… å¡å¯†æ¨¡å—åŠ è½½æˆåŠŸ');
        return module.exports;
    } catch (error) {
        console.log('âŒ ä» GitHub ä¸‹è½½å¤±è´¥:', error.message);
        
        // 3. å°è¯•ä½¿ç”¨è¿‡æœŸçš„ç¼“å­˜
        const cachedCode = readCache();
        if (cachedCode) {
            console.log('âš ï¸ ä½¿ç”¨è¿‡æœŸçš„ç¼“å­˜æ¨¡å—');
            try {
                const module = { exports: {} };
                eval(cachedCode);
                return module.exports;
            } catch (error) {
                console.log('âŒ ç¼“å­˜æ¨¡å—ä¹Ÿæ— æ³•åŠ è½½');
            }
        }
        
        throw new Error('æ— æ³•åŠ è½½å¡å¯†æ¨¡å—');
    }
}

module.exports = { loadCardKeyModule };
```

### æ­¥éª¤3ï¼šåœ¨è„šæœ¬ä¸­ä½¿ç”¨

ä¿®æ”¹ä½ çš„è„šæœ¬æ–‡ä»¶ï¼ˆä¾‹å¦‚ `ksjsb-with-cardkey.js`ï¼‰ï¼š

```javascript
const request = require("request");
const querystring = require("querystring");
const { SocksProxyAgent } = require("socks-proxy-agent");

process.noDeprecation = true;

// ========== åŠ¨æ€åŠ è½½å¡å¯†æ¨¡å— ==========
let CardKeyValidator, initializeCardKeyValidator, getCardKeyValidator;

async function loadCardKeyModuleFromGitHub() {
    const https = require('https');
    const GITHUB_RAW_URL = 'https://raw.githubusercontent.com/your-username/kuaishou-cardkey-validator/main/cardkey-validator.js';
    
    return new Promise((resolve, reject) => {
        https.get(GITHUB_RAW_URL, (res) => {
            if (res.statusCode !== 200) {
                reject(new Error(`ä¸‹è½½å¤±è´¥ï¼ŒçŠ¶æ€ç : ${res.statusCode}`));
                return;
            }

            let data = '';
            res.on('data', chunk => data += chunk);
            res.on('end', () => {
                try {
                    const module = { exports: {} };
                    eval(data);
                    resolve(module.exports);
                } catch (error) {
                    reject(error);
                }
            });
        }).on('error', reject);
    });
}

// åœ¨è„šæœ¬å¼€å§‹æ—¶åŠ è½½æ¨¡å—
(async () => {
    try {
        console.log('ğŸ”„ åŠ è½½å¡å¯†éªŒè¯æ¨¡å—...');
        const cardkeyModule = await loadCardKeyModuleFromGitHub();
        CardKeyValidator = cardkeyModule.CardKeyValidator;
        initializeCardKeyValidator = cardkeyModule.initializeCardKeyValidator;
        getCardKeyValidator = cardkeyModule.getCardKeyValidator;
        console.log('âœ… å¡å¯†æ¨¡å—åŠ è½½æˆåŠŸ');
        
        // ç»§ç»­æ‰§è¡Œä¸»ç¨‹åº
        await main();
    } catch (error) {
        console.log('âŒ å¡å¯†æ¨¡å—åŠ è½½å¤±è´¥:', error.message);
        process.exit(1);
    }
})();

async function main() {
    // ========== åŸæœ‰ä»£ç å¼€å§‹ ==========
    
    // ... å…¶ä»–ä»£ç  ...
    
    // åˆå§‹åŒ–å¡å¯†éªŒè¯å™¨
    initializeCardKeyValidator();
    
    // ... å…¶ä»–ä»£ç  ...
}
```

## ğŸ“ æ–¹æ¡ˆ2ï¼šå†…åµŒæ¨¡å—ä»£ç ï¼ˆæœ€ç®€å•ï¼‰

ç›´æ¥å°† `cardkey-validator.js` çš„ä»£ç å¤åˆ¶åˆ°è„šæœ¬å¼€å¤´ï¼š

```javascript
const request = require("request");
const querystring = require("querystring");
const { SocksProxyAgent } = require("socks-proxy-agent");

process.noDeprecation = true;

// ========== å¡å¯†éªŒè¯æ¨¡å—ï¼ˆå†…åµŒï¼‰ ==========
class CardKeyValidator {
    constructor(cardKey, options = {}) {
        this.cardKey = cardKey;
        this.verifyUrl = options.verifyUrl || process.env.VERIFY_URL || "http://3.xjyyds.cf:21442/api/verify";
        this.cacheTimeout = parseInt(options.cacheTimeout || process.env.VERIFY_CACHE_TIMEOUT || "3600", 10) * 1000;
        this.isVerified = false;
        this.verifyTime = null;
        this.verifyResult = null;
    }
    
    // ... å®Œæ•´çš„ç±»ä»£ç  ...
}

let globalCardKeyValidator = null;

function initializeCardKeyValidator(options = {}) {
    // ... å®Œæ•´çš„å‡½æ•°ä»£ç  ...
}

function getCardKeyValidator() {
    return globalCardKeyValidator;
}
// ========== å¡å¯†éªŒè¯æ¨¡å—ç»“æŸ ==========

// ... åŸæœ‰è„šæœ¬ä»£ç  ...
```

## ğŸ“ æ–¹æ¡ˆ3ï¼šä½¿ç”¨é’é¾™é¢æ¿ä¾èµ–ç®¡ç†

### æ­¥éª¤1ï¼šåœ¨é’é¾™é¢æ¿ä¸­æ·»åŠ ä¾èµ–

1. ç™»å½•é’é¾™é¢æ¿
2. è¿›å…¥"ä¾èµ–ç®¡ç†"
3. æ·»åŠ  NodeJs ä¾èµ–ï¼š
   ```
   github:your-username/kuaishou-cardkey-validator
   ```

### æ­¥éª¤2ï¼šåœ¨è„šæœ¬ä¸­å¼•ç”¨

```javascript
const { initializeCardKeyValidator, getCardKeyValidator } = require('kuaishou-cardkey-validator');
```

### æ­¥éª¤3ï¼šé‡å¯é’é¾™é¢æ¿å®¹å™¨

```bash
docker restart qinglong
```

## ğŸ¯ æ¨èæ–¹æ¡ˆé€‰æ‹©

### æ ¹æ®ä½ çš„åœºæ™¯é€‰æ‹©åˆé€‚çš„æ–¹æ¡ˆï¼š

| åœºæ™¯ | æ¨èæ–¹æ¡ˆ | ç†ç”± |
|------|---------|------|
| **å¤šä¸ªè„šæœ¬ä½¿ç”¨** | æ–¹æ¡ˆ1ï¼ˆä¾èµ–ç®¡ç†ï¼‰â­ | ç»Ÿä¸€ç®¡ç†ï¼Œä¾¿äºç»´æŠ¤å’Œæ›´æ–° |
| **é•¿æœŸç»´æŠ¤é¡¹ç›®** | æ–¹æ¡ˆ1ï¼ˆä¾èµ–ç®¡ç†ï¼‰â­ | ç‰ˆæœ¬æ§åˆ¶æ¸…æ™°ï¼Œç¬¦åˆæœ€ä½³å®è·µ |
| **ç½‘ç»œç¨³å®šç¯å¢ƒ** | æ–¹æ¡ˆ1ï¼ˆä¾èµ–ç®¡ç†ï¼‰â­ | æ ‡å‡†çš„ npm ä¾èµ–ç®¡ç†æ–¹å¼ |
| **å¿«é€Ÿæµ‹è¯•å¼€å‘** | æ–¹æ¡ˆ2ï¼ˆåŠ¨æ€åŠ è½½ï¼‰ | æ— éœ€é¢„å…ˆå®‰è£…ï¼Œå¿«é€Ÿéƒ¨ç½² |
| **å•ä¸ªè„šæœ¬é¡¹ç›®** | æ–¹æ¡ˆ2ï¼ˆåŠ¨æ€åŠ è½½ï¼‰ | è„šæœ¬ç›¸å¯¹ç‹¬ç«‹ï¼Œä¾¿äºåˆ†å‘ |
| **ç½‘ç»œä¸ç¨³å®š** | æ–¹æ¡ˆ3ï¼ˆå†…åµŒä»£ç ï¼‰ | å®Œå…¨ç¦»çº¿è¿è¡Œï¼Œæœ€ç¨³å®š |
| **ç½‘ç»œå—é™ç¯å¢ƒ** | æ–¹æ¡ˆ3ï¼ˆå†…åµŒä»£ç ï¼‰ | æ— éœ€å¤–éƒ¨èµ„æºï¼Œå®Œå…¨ç‹¬ç«‹ |

### æˆ‘çš„æ¨è

**é¦–é€‰ï¼šæ–¹æ¡ˆ1ï¼ˆä¾èµ–ç®¡ç†ï¼‰**
- è¿™æ˜¯æœ€æ ‡å‡†ã€æœ€ä¸“ä¸šçš„æ–¹å¼
- é€‚åˆå¤§å¤šæ•°åœºæ™¯
- ä¾¿äºé•¿æœŸç»´æŠ¤

**å¤‡é€‰ï¼šæ–¹æ¡ˆ2ï¼ˆåŠ¨æ€åŠ è½½ï¼‰**
- é€‚åˆå¿«é€Ÿæµ‹è¯•
- é€‚åˆå•ä¸ªè„šæœ¬é¡¹ç›®

**æœ€åï¼šæ–¹æ¡ˆ3ï¼ˆå†…åµŒä»£ç ï¼‰**
- ä»…åœ¨ç½‘ç»œå—é™æ—¶ä½¿ç”¨
- ç»´æŠ¤æˆæœ¬æœ€é«˜

## ğŸ“‹ å®Œæ•´ç¤ºä¾‹

### æ–¹æ¡ˆ1å®Œæ•´ç¤ºä¾‹ï¼ˆæ¨èï¼‰

```javascript
const request = require("request");
const querystring = require("querystring");
const { SocksProxyAgent } = require("socks-proxy-agent");

process.noDeprecation = true;

// ========== å¡å¯†æ¨¡å—åŠ è½½å™¨ ==========
let initializeCardKeyValidator, getCardKeyValidator;

async function loadCardKeyModule() {
    const https = require('https');
    const fs = require('fs');
    const path = require('path');
    
    const GITHUB_URL = 'https://raw.githubusercontent.com/your-username/kuaishou-cardkey-validator/main/cardkey-validator.js';
    const CACHE_FILE = path.join(__dirname, '.cardkey-validator-cache.js');
    const CACHE_DURATION = 24 * 60 * 60 * 1000; // 24å°æ—¶
    
    // æ£€æŸ¥ç¼“å­˜
    try {
        if (fs.existsSync(CACHE_FILE)) {
            const stats = fs.statSync(CACHE_FILE);
            if (Date.now() - stats.mtimeMs < CACHE_DURATION) {
                console.log('âœ… ä½¿ç”¨ç¼“å­˜çš„å¡å¯†æ¨¡å—');
                const code = fs.readFileSync(CACHE_FILE, 'utf8');
                const module = { exports: {} };
                eval(code);
                return module.exports;
            }
        }
    } catch (error) {
        console.log('âš ï¸ è¯»å–ç¼“å­˜å¤±è´¥');
    }
    
    // ä» GitHub ä¸‹è½½
    return new Promise((resolve, reject) => {
        console.log('ğŸ“¥ ä» GitHub ä¸‹è½½å¡å¯†æ¨¡å—...');
        https.get(GITHUB_URL, (res) => {
            if (res.statusCode !== 200) {
                reject(new Error(`ä¸‹è½½å¤±è´¥: ${res.statusCode}`));
                return;
            }
            
            let data = '';
            res.on('data', chunk => data += chunk);
            res.on('end', () => {
                try {
                    // ä¿å­˜ç¼“å­˜
                    fs.writeFileSync(CACHE_FILE, data, 'utf8');
                    
                    // åŠ è½½æ¨¡å—
                    const module = { exports: {} };
                    eval(data);
                    console.log('âœ… å¡å¯†æ¨¡å—åŠ è½½æˆåŠŸ');
                    resolve(module.exports);
                } catch (error) {
                    reject(error);
                }
            });
        }).on('error', reject);
    });
}

// ========== ä¸»ç¨‹åº ==========
(async () => {
    try {
        // åŠ è½½å¡å¯†æ¨¡å—
        const cardkeyModule = await loadCardKeyModule();
        initializeCardKeyValidator = cardkeyModule.initializeCardKeyValidator;
        getCardKeyValidator = cardkeyModule.getCardKeyValidator;
        
        // åˆå§‹åŒ–å¡å¯†éªŒè¯å™¨
        initializeCardKeyValidator();
        
        // ç»§ç»­æ‰§è¡ŒåŸæœ‰ä»£ç 
        await runMainScript();
    } catch (error) {
        console.log('âŒ ç¨‹åºå¯åŠ¨å¤±è´¥:', error.message);
        process.exit(1);
    }
})();

async function runMainScript() {
    // ========== åŸæœ‰è„šæœ¬ä»£ç  ==========
    
    // ... ä½ çš„åŸæœ‰ä»£ç  ...
    
    class KuaishouAdTask {
        async requestSignService(requestData, description) {
            const validator = getCardKeyValidator();
            if (!validator) {
                console.log('å¡å¯†éªŒè¯å™¨æœªåˆå§‹åŒ–');
                return null;
            }
            
            const verifyResult = await validator.verify();
            if (!verifyResult.success) {
                console.log('å¡å¯†éªŒè¯å¤±è´¥:', verifyResult.message);
                return null;
            }
            
            const requestDataWithKey = {
                ...requestData,
                card_key: validator.cardKey
            };
            
            // ... å‘é€è¯·æ±‚ ...
        }
    }
    
    // ... å…¶ä»–ä»£ç  ...
}
```

## âš ï¸ æ³¨æ„äº‹é¡¹

### é€šç”¨æ³¨æ„äº‹é¡¹

1. **ç¯å¢ƒå˜é‡å¿…éœ€**ï¼šæ— è®ºä½¿ç”¨å“ªç§æ–¹æ¡ˆï¼Œéƒ½å¿…é¡»è®¾ç½® `CARD_KEY` æˆ– `km` ç¯å¢ƒå˜é‡
2. **GitHub è®¿é—®**ï¼šæ–¹æ¡ˆ1å’Œæ–¹æ¡ˆ2éœ€è¦ç¡®ä¿é’é¾™é¢æ¿èƒ½è®¿é—® GitHub
3. **ç‰ˆæœ¬ç®¡ç†**ï¼šå»ºè®®ä½¿ç”¨ç‰ˆæœ¬æ ‡ç­¾ï¼ˆå¦‚ `#v1.0.0`ï¼‰ï¼Œä¾¿äºç‰ˆæœ¬æ§åˆ¶å’Œå›æ»š
4. **ç½‘ç»œç¨³å®šæ€§**ï¼šæ–¹æ¡ˆ1å’Œæ–¹æ¡ˆ2é¦–æ¬¡ä½¿ç”¨éœ€è¦ç½‘ç»œè¿æ¥

### æ–¹æ¡ˆ1ï¼ˆä¾èµ–ç®¡ç†ï¼‰æ³¨æ„äº‹é¡¹

- å®‰è£…ä¾èµ–åéœ€è¦é‡å¯ç›¸å…³ä»»åŠ¡
- æ›´æ–°ä¾èµ–æ—¶å»ºè®®å…ˆåˆ é™¤æ—§ç‰ˆæœ¬
- ç§æœ‰ä»“åº“éœ€è¦é…ç½® GitHub è®¿é—®ä»¤ç‰Œ

### æ–¹æ¡ˆ2ï¼ˆåŠ¨æ€åŠ è½½ï¼‰æ³¨æ„äº‹é¡¹

- ä½¿ç”¨ç¼“å­˜æœºåˆ¶é¿å…é¢‘ç¹ä¸‹è½½
- é¦–æ¬¡è¿è¡Œéœ€è¦ç½‘ç»œè¿æ¥
- GitHub è®¿é—®æ…¢æ—¶å¯ä½¿ç”¨é•œåƒ

### æ–¹æ¡ˆ3ï¼ˆå†…åµŒä»£ç ï¼‰æ³¨æ„äº‹é¡¹

- æ›´æ–°æ¨¡å—éœ€è¦æ‰‹åŠ¨ä¿®æ”¹æ‰€æœ‰è„šæœ¬
- ä»£ç å†—ä½™ï¼Œç»´æŠ¤æˆæœ¬é«˜
- é€‚åˆç½‘ç»œå—é™ç¯å¢ƒ

## ğŸ”§ æ•…éšœæ’é™¤

### é—®é¢˜1ï¼šæ— æ³•è®¿é—® GitHub

**ç—‡çŠ¶ï¼š**
```
Error: getaddrinfo ENOTFOUND raw.githubusercontent.com
```

**è§£å†³æ–¹æ¡ˆï¼š**
1. ä½¿ç”¨ GitHub é•œåƒåŠ é€Ÿï¼š
   ```
   https://ghproxy.com/https://raw.githubusercontent.com/...
   ```
2. æˆ–ä½¿ç”¨æ–¹æ¡ˆ3ï¼ˆå†…åµŒä»£ç ï¼‰ï¼Œå®Œå…¨ç¦»çº¿è¿è¡Œ
3. æˆ–é…ç½® GitHub ä»£ç†

### é—®é¢˜2ï¼šä¾èµ–å®‰è£…å¤±è´¥

**ç—‡çŠ¶ï¼š**
```
npm ERR! 404 Not Found
```

**è§£å†³æ–¹æ¡ˆï¼š**
1. æ£€æŸ¥ GitHub ä»“åº“åœ°å€æ˜¯å¦æ­£ç¡®
2. ç¡®è®¤ä»“åº“æ˜¯ Public æˆ–å·²é…ç½®è®¿é—®ä»¤ç‰Œ
3. å°è¯•ä½¿ç”¨å®Œæ•´çš„ GitHub URLï¼š
   ```bash
   npm install https://github.com/your-username/universal-cardkey-validator
   ```

### é—®é¢˜3ï¼šç¼“å­˜å¤±æ•ˆï¼ˆæ–¹æ¡ˆ2ï¼‰

**ç—‡çŠ¶ï¼š**
æ¨¡å—é¢‘ç¹é‡æ–°ä¸‹è½½

**è§£å†³æ–¹æ¡ˆï¼š**
1. æ‰‹åŠ¨åˆ é™¤ç¼“å­˜æ–‡ä»¶ï¼š`.cardkey-validator-cache.js`
2. è°ƒæ•´ç¼“å­˜æ—¶é—´ï¼ˆåœ¨åŠ è½½å™¨ä»£ç ä¸­ä¿®æ”¹ `CACHE_DURATION`ï¼‰
3. æ£€æŸ¥æ–‡ä»¶ç³»ç»Ÿæƒé™

### é—®é¢˜4ï¼ševal å®‰å…¨è­¦å‘Šï¼ˆæ–¹æ¡ˆ2ï¼‰

**ç—‡çŠ¶ï¼š**
```
Warning: eval can be harmful
```

**è§£å†³æ–¹æ¡ˆï¼š**
- è¿™æ˜¯åŠ¨æ€åŠ è½½çš„å¿…è¦æ–¹å¼ï¼Œå±äºæ­£å¸¸ç°è±¡
- ç¡®ä¿åªä»å¯ä¿¡çš„ GitHub ä»“åº“åŠ è½½ä»£ç 
- æˆ–ä½¿ç”¨æ–¹æ¡ˆ1ï¼ˆä¾èµ–ç®¡ç†ï¼‰æˆ–æ–¹æ¡ˆ3ï¼ˆå†…åµŒä»£ç ï¼‰

### é—®é¢˜5ï¼šæ¨¡å—ç‰ˆæœ¬å†²çª

**ç—‡çŠ¶ï¼š**
```
Error: Cannot find module 'universal-cardkey-validator'
```

**è§£å†³æ–¹æ¡ˆï¼š**
```bash
# æ¸…é™¤ npm ç¼“å­˜
npm cache clean --force

# åˆ é™¤ node_modules
rm -rf node_modules

# é‡æ–°å®‰è£…
npm install
```

### é—®é¢˜6ï¼šé’é¾™é¢æ¿æƒé™é—®é¢˜

**ç—‡çŠ¶ï¼š**
```
EACCES: permission denied
```

**è§£å†³æ–¹æ¡ˆï¼š**
```bash
# è¿›å…¥é’é¾™å®¹å™¨
docker exec -it qinglong bash

# ä¿®å¤æƒé™
chown -R root:root /ql/scripts
chmod -R 755 /ql/scripts

# é‡æ–°å®‰è£…ä¾èµ–
cd /ql/scripts
npm install
```
